<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="Game_style.css" /> 
    <title>421</title>
  </head>
  <body>
    <button type="button" onclick="Jeu();"  id="nb_j">Nombre de joueur </button>
    <input type="text" placeholder="donner le nombre de joueur" id="in"  >
    </body>
  </br>
</br>
</br>
  <body>
    <button type="button" onclick="getValue();"  value="start"  id="start" >Commencer </button>
    </body>
  </br>
    <button type="button"    id='relancer'  value="Relancer" hidden>      Relancer         </button>
  </br>
  <button type="button"    id='valider'  value="Valider le resultat" hidden >  Valider le resultat     </button>
</br>
<body>
  <input type="text" value ="" id="resultat_score" hidden>
</body>
</br>
<body>
  <input type="text" value ="" id="winner" hidden>
</body>
</br>
<script>
        let codage= ["000","001","010", "011","100","101","110","111"]
        let image_dé= ['dice/dice1.png','dice/dice2.png','dice/dice3.png','dice/dice4.png','dice/dice5.png','dice/dice6.png']
       
    function  bit_aleatoir() {
            min = Math.ceil(0);
            max = Math.floor(1);
            var random =Math.floor( Math.random() * (max-min+1))+ min; 
            return random;
        }

    function getscore ( dé1 , dé2 , dé3)
        {   
          if (dé1==6 && dé2==6 &&  dé3==6 ){ return 6}
          if (dé1==5 && dé2==5 &&  dé3==5) { return 5}
          if (dé1==4 && dé2==4 &&  dé3==4) { return 4}
          if (dé1==3 && dé2==3 &&  dé3==3) { return 3}
          if (dé1==2 && dé2==2 &&  dé3==2) { return 2}
          if (dé1==1 && dé2==1 &&  dé3==1) { return 7}
        if (dé1==1 && dé2==1  )
            {
             if(dé3==6)  {return 6 }   else {  if(dé3==5)  {return 5 } else {  if(dé3==4)  {return 4 }else {if(dé3==3)  {return 3}else {if(dé3==2)  {return 2}}}  }  }   
            }
       if (dé2==1 && dé3==1  )
            { if(dé1==6)  {return 6 }   else {  if(dé1==5)  {return 5 } else {  if(dé1==4)  {return 4 }else {if(dé1==3)  {return 3}else {if(dé1==2)  {return 2}}}  }  }
             }
            if (dé1==1 && dé3==1  )
            { if(dé2==6)  {return 6 }   else {  if(dé2==5)  {return 5 } else {  if(dé2==4)  {return 4 }else {if(dé2==3)  {return 3}else {if(dé2==2)  {return 2}}}  }  } }
            return 1 ;
        }
    var a_dé1 = document.createElement("img");        var a_dé2 = document.createElement("img");       var a_dé3 = document.createElement("img");
    
    function calcul_valeur_de()
    {   var dé_1 , dé_2 , dé_3 ; 
      dé_1= bit_aleatoir().toString()+ bit_aleatoir().toString() +bit_aleatoir().toString();   // le codage du du dé1 
      dé_2= bit_aleatoir().toString()+ bit_aleatoir().toString() +bit_aleatoir().toString();  
      dé_3= bit_aleatoir().toString()+ bit_aleatoir().toString() +bit_aleatoir().toString();  
      var val_dé1 = codage.indexOf(dé_1,0)+1;   if (val_dé1==7) {val_dé1=1} ; if (val_dé1==8) {val_dé1=2} 
      var val_dé2 = codage.indexOf(dé_2,0)+1;   if (val_dé2==7) {val_dé2=1}; if (val_dé2==8) {val_dé2=2}
      var val_dé3 = codage.indexOf(dé_3,0)+1;   if (val_dé3==7) {val_dé3=1}; if (val_dé3==8) {val_dé3=2}
      let liste=  [val_dé1 ,val_dé2, val_dé3];
      a_dé1.src =image_dé[ liste[0]-1];  a_dé2.src =image_dé[ liste[1]-1];  a_dé3.src = image_dé [liste[2]-1]; 
      document.body.appendChild(a_dé1); document.body.appendChild(a_dé2); document.body.appendChild(a_dé3);
      return liste ;
    }

   var bt_start = document.getElementById('nb_j');
   var nb_j=1; var input ;
   var partie_terminer ;
   var valider = document.getElementById('valider'); 
   var submitButton = document.getElementById('relancer');
   var dé_1 , dé_2 , dé_3 ; 
   resultat = [];
   var images = document.getElementsByTagName('img');

  valider.addEventListener('click', function valider() {  //une fois que le joueur valide on calcule son score et on passe au suivant 
  
          images[0].parentNode.removeChild(images[0]);
          images[0].parentNode.removeChild(images[0]);
          images[0].parentNode.removeChild(images[0]);
          if (nb_j !=input  && partie_terminer==false  )
              {  
              score =getscore(dé_1,dé_2,dé_3);
               console.log("joeur suivant")
              var btn= document.getElementById("start").style.visibility="";
              var btn= document.getElementById("relancer").style.display = "none";
              var btn= document.getElementById("valider").style.display = "none";
              let element ={}
              element.joueur=nb_j
              element.score=score
              resultat.push( element);
              var resultat_output = document.getElementById("resultat_score")
              resultat_output.style.display='block'
              resultat_output.value="{numero_joueur:"+element.joueur.toString()+ ","+ "score :"+element.score.toString() +"} \n" +resultat_output.value;
         
              nb_j++; 
              console.log(resultat)
              }else { partie_terminer =true; 
                     score =getscore(dé_1,dé_2,dé_3);
                     let element ={}
                      element.joueur=nb_j
                      element.score=score
                      resultat.push( element);
                      resultat.sort(function compare(a, b) {  if (a.score < b.score)
                                                                  return -1;
                                                                if (a.score > b.score )
                                                                  return 1;
                                                                return 0;});
                      console.log(resultat)
                      
                      var resultat_output = document.getElementById("winner")
                      resultat_output.style.display='block'
                      resultat_output.value="{numero_ganiant:"+resultat[input-1].joueur.toString()+ ","+ "score :"+resultat[input-1].score.toString() +"}";
                      console.log("le ganiant est ") ;console.log(resultat[input-1])
                     console.log("Fin de la partie ") 
                     }
     });  

    submitButton.addEventListener('click', function relancer() {   // fonction qui s'exute a chaque fois qu'un utilisateru veut relancer (max 3 fois)
    
       images[0].parentNode.removeChild(images[0]);

       if (buttonClicked_2 &&  buttonClicked_4==false) {          
          buttonClicked_3 = true
          }else { if  (buttonClicked_2==false) {
          buttonClicked_2= true;
          liste=calcul_valeur_de() ;
          dé_1=liste.at(0) ;     dé_2=liste.at(1)  ;  dé_3=liste.at(2)
          console.log(liste) ;console.log('il vous reste une seul chance');  }
          }
          if ( buttonClicked_3==true ) {   
          liste=calcul_valeur_de() ;
          dé_1=liste.at(0) ;     dé_2=liste.at(1)  ;  dé_3=liste.at(2); 
          console.log(liste)  ;  buttonClicked_3 = false ; 
          console.log('il vous reste  aucune chance ');  buttonClicked_4=true;
          }
      });
     var buttonClicked_2 , buttonClicked_3 , buttonClicked_4;

  function getValue() {
      let continuer=true ; let  score=0   ;
      var btn= document.getElementById("start").style.visibility="hidden";
      var btn= document.getElementById("relancer").style.display = "block";
      var btn= document.getElementById("valider").style.display = "block";
     
      var liste=calcul_valeur_de() ;
      dé_1=liste.at(0) ;  dé_2=liste.at(1)  ;  dé_3=liste.at(2) 
      console.log(liste)  
       buttonClicked_2 = false;   buttonClicked_3 = false;   buttonClicked_4 = false;
       if (nb_j==1) {partie_terminer=false ;}
     }
     
  var buttonClicked_2 = false;
  function Jeu()
      {        input = document.getElementById("in").value;   //le nombre de joueurs 
              if (buttonClicked_2) { consol.log("vous avez un nombre de joueur") ; } else 
              {  buttonClicked_2 = true;
                console.log("vous avez '%d' joueur ", input)
                 var btn= document.getElementById("nb_j").style.visibility="hidden";
              }
      }        
 </script>
 </body>

</html>
